{% extends 'base.html' %}

{% block title %}Tissue Inventory Verification{% endblock %}


{% block content %}

	<div class='large-headline'>Tissue Inventory Verification</div>
	<div class='clearfix'>
		{% if formset %}
			<form method="post" action="">
				{{ formset.management_form }}
				{% csrf_token %}
				<table style="width:100%;">
					<tr></tr>
					{# hack to remove the color and add a tiny space between this table and the titleblock #}
					<tr>
						<td align="center">
							<button type='submit' name='submit' class='blockLinkCheckoutButton' style='width:100px;float: right'>Update</button>
						</td>
						<td align="center" class='verification_legend unverified'>Unverified</td>
						<td align="center" class='verification_legend sufficient'>Verified: sufficient</td>
						<td align="center" class='verification_legend insufficient'>Verified: insufficent</td>
						<td align="center">
							<button type='submit' name='export' class='blockLinkDeleteButton' style='width:100px;float: right'>Export PDF</button>
						</td>
					</tr>
					<tr></tr>
					{# hack to add a tiny space between this table and the formset #}
				</table>
				<center>
					{% for tiv in formset %}
						{{ tiv.primarykey }} {# Important! #}
						{% if tiv.initial.inventory == "Unverified" %}
							<div class='verification_border unverified'>
						{% endif %}
						{% if tiv.initial.inventory == "Sufficient" %}
							<div class="verification_border sufficient">
						{% endif %}
						{% if tiv.initial.inventory == "Insufficient" %}
							<div class="verification_border insufficient">
						{% endif %}
					{{ tiv.non_field_errors }}
					{% if tiv.initial.notes %}
						<div style="background-color: orange;">
							{{ tiv.initial.notes }}
						</div>
					{% endif %}
					{% if tiv.initial.req_request %}
						<div style='text-align: left; background-color: yellow'>
								<b>Warning:</b> This tissue has been accepted, but not shipped, for another request.  Please take into account the accepted request before verifying this tissue.<br>
								{% load review_tags %}
								{% colliding_accepted_requests tiv.initial.req_request tiv.initial.tissue tiv.initial.monkey %}
						</div>
					{% endif %}

					<center>
						<table class='verification_table'>
							<tr>
								<th>Monkey: {{ tiv.initial.monkey }}</th>
								<th>Tissue: {{ tiv.initial.tissue }}</th>
							</tr>
							<tr>
								<td>
									<label>Freezer: </label>{{ tiv.freezer }}<br>
									<label>Location:</label>{{ tiv.location }}<br>
									<label>Quantity:</label>{{ tiv.quantity }}<br>
									<label>Units:</label>{{ tiv.units }}<br>
								</td>
								<td>
									<label>Tissue Details:</label><br>{{ tiv.details }}<br>
									Freezer inventory is {{ tiv.inventory }} for request: {{ tiv.initial.amount }}

								</td>
							</tr>
						</table>
						<br>
						</div>
					{% endfor %}
				</center>
				<table style="width:100%;">
					<tr>
						<td align="center"><input type='submit' name='submit' class='blockLinkCheckoutButton' value='Update' style='width:100px;float: left'/></td>
						<td align="center" class='verification_legend unverified'>Unverified</td>
						<td align="center" class='verification_legend sufficient'>Verified: sufficient</td>
						<td align="center" class='verification_legend insufficient'>Verified: insufficent</td>
						<td align="center"><input type='submit' name='submit' class='blockLinkDeleteButton' value='Export PDF' style='width:100px;float: right'/></td>
					</tr>
				</table>
			</form>
		{% endif %}
		{% if form %}
			<form action='' method='post'>
				{% csrf_token %}
				<table style="width:100%;">
					<tr></tr>
					{# hack to remove the color and add a tiny space between this table and the titleblock #}
					<tr>
						<td align="center">
							<button type='submit' name='submit' class='blockLinkCheckoutButton' style='width:100px;float: right'>Update</button>
						</td>
						<td align="center" class='verification_legend unverified'>Unverified</td>
						<td align="center" class='verification_legend sufficient'>Verified: sufficient</td>
						<td align="center" class='verification_legend insufficient'>Verified: insufficent</td>
						<td align="center">
							<button type='submit' name='export' class='blockLinkDeleteButton' style='width:100px;float: right'>Export PDF</button>
						</td>
					</tr>
					<tr></tr>
					{# hack to add a tiny space between this table and the formset #}
				</table>
			</form>
		{% endif %}
	</div>

	<br>


{% endblock %}