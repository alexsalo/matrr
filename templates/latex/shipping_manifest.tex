{% spaceless %}
{% load tissue_filters %}
\documentclass{article}[letterpaper]

\usepackage{fullpage}
\usepackage{multirow}
\usepackage{longtable}

\begin{document}

\begin{center}
\Large{ \textbf{Shipping Manifest for:\\ User: {{ req_request.user }} Cohort: {{ req_request.cohort }}
 } } \\
\normalsize{Requested On: {{ req_request.req_request_date }} \\
Manifest Created On: {{ time }} }
\end{center}

\section*{Shipping info}

{{ account.act_shipping_name }} \\
{{ account.act_address1 }} \\{% if account.act_address2 %}{{ account.act_address2 }} \\{% endif %}
{{ account.act_city }}, {{ account.act_state }} {{ account.act_zip }} \\
{{ account.act_country }}

\vspace{0.1in}
\noindent Fedex Number: {{ account.act_fedex }}

\section*{Requested Tissues}

{% for tissue_request in req_request.get_requested_tissues %}
  {% if tissue_request.get_accepted %}
  {% for datum in tissue_request.get_data %}
    {% if forloop.counter == 1 %}
      \subsection*{ {{ datum.0 }}: {{ datum.1 }} }
    {% else %}
      \noindent {{ datum.0 }}: {{ datum.1 }}
    {% endif %}
  {% endfor %}

  \vspace{0.05in}
  {% if tissue_request.get_tissue %}
  \subsubsection*{Requested Monkeys}
  \nopagebreak[3]
  \noindent
  \begin{longtable}{|c|c|c|}
  \hline
  {% for monkey in tissue_request.accepted_monkeys.all %}
  Monkey: & {{ monkey.mky_real_id }} & {{ monkey.mky_name }} \\* \nopagebreak \hline
  {% with samples=tissue_request.get_tissue|get_stock:monkey %}
    {% if samples.count %}
      {% for sample in samples.all %}
        Sample Location: & \multicolumn{2}{|p{4in}|}{ {{ sample.get_location }} } \\* \hline
        Last Updated: & \multicolumn{2}{|p{4in}|}{ {{ sample.get_modified }} }
        {% if forloop.last %}\\{% else %}\\{% endif %} \hline
      {% endfor %}
    {% else %}
      \multicolumn{3}{|p{6in}|}{There are no samples for this tissue and monkey in the inventory.
      The tissue is either not harvested yet or it needs to be extracted from another item} \\ \hline
    {% endif %}
  {% endwith %}
  {% endfor %}
  \end{longtable}
  {% else %}
  \noindent This is a custom request, so there is no inventory data available.
  \nopagebreak
  \subsubsection*{Requested Monkeys}
  \begin{longtable}{|c|c|c|}
  \hline
  {% for monkey in tissue_request.accepted_monkeys.all %}
    Monkey: & {{ monkey.mky_real_id }} & {{ monkey.mky_name }} \\ \hline
  {% endfor %}
  \end{longtable}
  {% endif %}
  \pagebreak[3]
  {% endif %}
{% endfor %}

\end{document}

{% endspaceless %}